# ì±„ë¹„ í¬íŒ…ë©”ë‰´ì–¼

## ëª©ì°¨

1. [ê°œë°œ í™˜ê²½](#ê°œë°œ-í™˜ê²½)
3. [í™˜ê²½ ì„¤ì •](#í™˜ê²½-ì„¤ì •)
    - [í™˜ê²½ë³€ìˆ˜](#í™˜ê²½ë³€ìˆ˜)
    - [Docker ì„¤ì¹˜](#docker-ì„¤ì¹˜)
4. [ë¹Œë“œ ë°©ë²•](#ë¹Œë“œë°©ë²•)



## ê°œë°œ í™˜ê²½

- Ubuntu 20.04.6 LTS (GNU/Linux 5.15.0-1063-aws x86_64)
- IntelliJ IDEA (2024.1.4)
- Visual Studio Code (1.86)

## FrontEnd
- react-native 0.76
- Next.JS 15.0.2
- TypeScript 
- native wind 4.1
- Tailwind CSS 3.4.10

## BackEnd

- Java 17 (openjdk-17)
- Spring Boot 3.3.2
- Spring Security 5.7.1
- Hibernate 6.6

## DB

- MySQL 8.0.38

## INFRA

- Ubuntu 20.04.6
- Docker 27.2.1
- Jenkins 2.4777
- NginX 1.18.0

## âš™ï¸ í™˜ê²½ ì„¤ì •

### ğŸ”“ í™˜ê²½ë³€ìˆ˜

```yml
/*.yml*/
spring:
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 30MB
  jackson:
    time-zone: Asia/Seoul
    parser:
      allow-unquoted-control-chars: true
  data:
    redis:
      host:   # Redis ì„œë²„ í˜¸ìŠ¤íŠ¸
      port:       # Redis ì„œë²„ í¬íŠ¸
      password: pw
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    username: name #ë³„ë„ ì‘ì„±
    password: pw # ë³„ë„ ì‘ì„±
    url: jdbc:mysql://server:3306/free?serverTimezone=Asia/Seoul&useUnicode=true&character_set_server=utf8mb4

  jpa:
    database: mysql
    database-platform: org.hibernate.dialect.MySQL8Dialect
    generate-ddl: false
    hibernate:
        ddl-auto: update
    properties:
        hibernate:
          format_sql: true
    show-sql: true


jwt:
    secret : secret
    expiration : 4320000
    refreshexpiration : 25920000

cloud:
  aws:
    s3:
      bucket: bucket
    stack.auto: false
    region.static: ap-northeast-2
    credentials:
        accessKey: access-key
        secretKey: secret-key

coolsms:
  apikey: api
  apisecret: secret
  fromnumber: phone
  #ì „í™”ë²ˆí˜¸ëŠ” '-' ë¹¼ê³ 

cors:
  allowed-origins: http://localhost:3000, http://localhost:8080, http://k11a309.p.ssafy.io:3000, http://k11a309.p.ssafy.io

fastApi:
  url: http://k11a309.p.ssafy.io:8000/

app:
  img: img


### ğŸ‹ Docker ì„¤ì¹˜
```bash
# Docker ì„¤ì¹˜ë¥¼ ìœ„í•œ íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸
sudo apt update
# í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜
sudo apt install -y apt-transport-https ca-certificates curl software-properties-common
# Docker GPG í‚¤ ì¶”ê°€
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
# Docker ì €ì¥ì†Œ ì¶”ê°€
sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_rele
ase -cs) stable"
# íŒ¨í‚¤ì§€ ëª©ë¡ ì—…ë°ì´íŠ¸
sudo apt update
# Docker ì„¤ì¹˜
sudo apt install -y docker-ce
# Docker ì„¤ì¹˜ í™•ì¸
docker --version
```



## âš’ï¸ **ë¹Œë“œë°©ë²•**

```Groovy
pipeline {
    agent any

    environment {
        // ê³µí†µ í™˜ê²½ ë³€ìˆ˜
        GITLAB_CREDENTIALS_ID = "gitlab"
        GITLAB_REPO = "https://lab.ssafy.com/s11-final/S11P31A309.git"
        BRANCH = "be"
 
        SSH_CREDENTIALS_ID = "ssafy-ec2-user"
        SERVER_IP = "43.201.33.45"
    }

   stages {
        stage('Github Clone') {
            steps {
                git branch: "${BRANCH}",
                credentialsId: "${GITLAB_CREDENTIALS_ID}",
                url: "${GITLAB_REPO}"
            }
        }

        stage('Backend - Add Env') {
            steps {
                dir('./backend') {
                    withCredentials([
                        file(credentialsId: 'application', variable: 'application'),
                    ]) {
                        sh '''
                            mkdir -p src/main/resources
                            chmod -R 777 src/main/resources
                            cp ${application} src/main/resources/application.yml
                        '''
                    }
                }
            }
        }

        stage('Shutdown') {
            steps {
                script {
                    // ì´ë¯¸ ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆê°€ ìˆë‹¤ë©´ ì¢…ë£Œ
                    sh 'docker container rm -f backend-app || true'
                    sh 'docker container rm -f ai-app || true'
                }
            }
        }

        stage('Build') {
          steps {
            dir('backend') {
              sh 'chmod +x gradlew'     
              sh './gradlew wrapper'
              sh './gradlew build'
            }
          }
        }

        stage('Docker Build') {
            parallel {
                stage('Java Docker Build') {
                    steps {
                        dir('./backend') {
                            sh 'docker build -t backend . '
                        }
                    }
                }
                stage('Python Docker Build') {
                    steps {
                        dir('./AI') {
                            sh 'docker build -t ai . '
                        }
                    }
                }
            }
        }

//         stage('Create Volume') {
//             steps {
//                 sh 'docker volume create data || true'
//             }
//         }

        stage('Docker Run') {
            parallel {
                stage('Java Docker Run') {
                    steps {
                        dir('./backend') {
                            sh 'docker run --name backend-app -d -v data:/data -p 8080:8080 -e TZ=Asia/Seoul backend'
                        }
                    }
                }
                stage('Python Docker Run') {
                    steps {
                          dir('./AI') {
                                    sh '''
                                        docker run --name ai-app -d \
                                        -v /home/ubuntu/code/data:/code/data \
                                        -p 8000:8000 \
                                        -e TZ=Asia/Seoul \
                                        ai
                                    '''
                            }
                    }
                }
            }
        }
    }
}

//web
pipeline {
    agent any

    environment {
        // ê³µí†µ í™˜ê²½ ë³€ìˆ˜
        GITLAB_CREDENTIALS_ID = "gitlab"
        GITLAB_REPO = "https://lab.ssafy.com/s11-final/S11P31A309.git"
        BRANCH = "yoonha"
 
        SSH_CREDENTIALS_ID = "ssafy-ec2-user"
        SERVER_IP = "43.201.33.45"
    }

   stages {
        stage('Github Clone') {
            steps {
                git branch: "${BRANCH}",
                credentialsId: "${GITLAB_CREDENTIALS_ID}",
                url: "${GITLAB_REPO}"
            }
        }

        stage('Shutdown') {
            steps {
                script {
                    // ì´ë¯¸ ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆê°€ ìˆë‹¤ë©´ ì¢…ë£Œ
                    sh 'docker container rm -f frontend-app || true'
                }
            }
        }

        stage('Front - Docker - Build') {
          steps {
            dir('./web-view/chaebi') {
              sh 'docker build -t frontend . '
            }
          }
        }


        stage('Docker Run') {
            parallel {
                stage('Next Docker Run') {
                    steps {
                        dir('./web-view') {
                            sh 'docker run --name frontend-app -d -v data:/data -p 3000:3000 -e TZ=Asia/Seoul frontend'
                        }
                    }
                }
            }
        }
    }
}



```

### docker ì‹¤í–‰ ë°©ë²•
```bash
docker run -d --name ${service} -p ${inPort}:${outPort}  -e TZ=Asia/Seoul ${name}
```

